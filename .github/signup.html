<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ユーザー登録</title>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/vuetify@2.6.15/dist/vuetify.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/vuetify@2.6.15/dist/vuetify.js"></script>
</head>
<body>
  <div id="app">
    <v-app>
      <v-container>
        <!-- タイトル -->
        <v-row class="text-h4 mb-4" justify="center">ユーザー登録</v-row>

        <!-- ユーザー情報入力フォーム -->
        <v-row justify="center">
          <v-col cols="12" sm="6" md="4">
            <v-text-field v-model="userid" label="ユーザーID" outlined></v-text-field>
            <v-text-field v-model="password" label="パスワード" type="password" outlined></v-text-field>
            <v-text-field v-model="displayName" label="表示名" outlined></v-text-field>

            <v-btn color="primary" class="mt-4" block @click="signup">登録</v-btn>
            <v-btn text class="mt-2" block @click="goToLogin">ログインに戻る</v-btn>
          </v-col>
        </v-row>

        <!-- エラー表示ダイアログ -->
        <v-dialog v-model="dialog" max-width="400">
          <v-card>
            <v-card-title class="headline">エラー</v-card-title>
            <v-card-text>{{ errorMessage }}</v-card-text>
            <v-card-actions>
              <v-spacer></v-spacer>
              <v-btn color="primary" text @click="dialog = false">閉じる</v-btn>
            </v-card-actions>
          </v-card>
        </v-dialog>

        <!-- 成功表示ダイアログ -->
        <v-dialog v-model="successDialog" max-width="400">
          <v-card>
            <v-card-title class="headline">成功</v-card-title>
            <v-card-text>{{ message }}</v-card-text>
            <v-card-actions>
              <v-spacer></v-spacer>
              <v-btn color="primary" text @click="goToLogin">OK</v-btn>
            </v-card-actions>
          </v-card>
        </v-dialog>
      </v-container>
    </v-app>
  </div>

  <script>
    new Vue({
      el: '#app',
      vuetify: new Vuetify(),
      data: {
        userid: '',
        password: '',
        displayName: '',
        message: '',
        errorMessage: '',
        dialog: false,
        successDialog: false
      },
      methods: {
        // サインアップ処理
        async signup() {
          if (!this.userid || !this.password || !this.displayName) {
            this.errorMessage = "全ての項目を入力してください。";
            this.dialog = true;
            return;
          }

          try {
            const response = await axios.post('https://m3h-tsukagoshi-0730.azurewebsites.net/api/INSERTUSER?', {
              ID: this.userid,
              Password: this.password,
              Name: this.displayName
            });

            // 成功・失敗時メッセージ出力
            this.message = response.data;
            this.successDialog = true;
            this.errorMessage = '';
          } catch (err) {
            this.errorMessage = "登録エラー：" + (err.response?.data || err.message);
            this.dialog = true;
          }
        },

        // ログイン画面に移動
        goToLogin() {
          window.location.href = "index.html";
        }
      }
    });
  </script>
</body>
</html>
